# Code Deletion Log

## [2026-02-02] Refactor Session - Dead Code Analysis

### Summary

Analysis of the SkillGate codebase for dead code, unused exports, duplicate code, and unused dependencies.

### Unused Dependencies Removed

| Package | Version | Reason |
|---------|---------|--------|
| simple-git | ^3.22.0 | Never imported - GitIngestor uses native child_process.exec instead |

**Impact:** Removed 3 packages from node_modules

---

### Findings - NOT Removed (Documented for Future Reference)

#### 1. Duplicate Type Definitions (MEDIUM PRIORITY)

**Location:** Two parallel Policy type hierarchies exist:

| File | Types Defined |
|------|--------------|
| `src/types/policy.ts` | ThresholdsSchema, RuleDefinitionSchema, ExceptionSchema, PolicySchema, Policy, PolicyEvaluationResult |
| `src/core/policy/schema.ts` | Same types with additional validation, refinements, descriptions, and extra fields (extends, reason) |

**Issue:** The `src/core/policy/schema.ts` is the more complete and actively used version. The types in `src/types/policy.ts` have subtle incompatibilities (e.g., missing `extends` field, missing `reason` in Exception).

**Current Usage:**
- `src/core/scanner/base.ts` imports `Policy` from `src/types/index.js`
- All policy loading/validation uses `src/core/policy/schema.js`

**Recommendation:** Consolidate to use `src/core/policy/schema.ts` as single source of truth.

**Risk Level:** MEDIUM - Requires careful refactoring due to type incompatibilities

---

#### 2. Duplicate SourceType and Decision Types (LOW PRIORITY)

**SourceType defined in:**
- `src/types/report.ts` (line 11)
- `src/core/ingestor/types.ts` (line 4)

**Decision defined in:**
- `src/types/report.ts` (line 6)
- `src/core/enforcer/index.ts` (line 8)

**Recommendation:** Consolidate duplicates into single source

---

#### 3. Unused Exports from src/types/policy.ts (LOW PRIORITY)

The following exports are defined but never imported directly:
- `ThresholdsSchema`
- `RuleDefinitionSchema`
- `ExceptionSchema`
- `PolicySchema`
- `PolicyEvaluationResult`

**Note:** These are re-exported via index.ts and may be part of public API

---

#### 4. Unused Exports from src/utils/ (LOW PRIORITY - KEEP)

Functions exported but not imported elsewhere in codebase:
- `hashString` - used in tests only
- `hashFile` - used in tests only
- `hashDirectory` - used in tests only
- `isDirectory` - internal use in hash.ts
- `isFile` - internal use in hash.ts
- `maskSecrets` - internal use in mask.ts
- `maskPath` - never used
- `SECRET_PATTERNS` - internal use in mask.ts

**Decision:** KEEP - These are intentionally exported as public API utilities

---

#### 5. Unused Factory Functions (LOW PRIORITY - KEEP)

The following factory functions are exported but never used in the codebase:
- `createJsonReporter()` - from `src/core/reporter/json.ts`
- `createMarkdownReporter()` - from `src/core/reporter/markdown.ts`
- `createEntrypointDetector()` - from `src/core/scanner/entrypoint.ts`
- `createDependencyScanner()` - from `src/core/scanner/dependency.ts`
- `createCIRiskAnalyzer()` - from `src/core/scanner/ci-risk.ts`
- `validatePolicy()` - from `src/core/policy/schema.ts`
- `validatePolicySafe()` - from `src/core/policy/schema.ts`
- `formatValidationErrors()` - from `src/core/policy/schema.ts`

**Decision:** KEEP - These are public API convenience functions

---

#### 6. Unused Re-exports from src/core/scanner/index.ts (LOW PRIORITY - KEEP)

- `getFiles`
- `readFileContent`
- `matchesPattern`
- `getExtension`
- `GetFilesOptions`
- `dependencyParsers`

**Decision:** KEEP - These are public API exports for external use

---

### Testing Results

After removing `simple-git`:
- Build: PASSED
- Tests: 404/404 PASSED
- No regressions

---

### Impact Summary

| Metric | Value |
|--------|-------|
| Dependencies removed | 1 (simple-git) |
| Packages removed from node_modules | 3 |
| Files deleted | 0 |
| Lines of code removed | 0 |
| Unused exports identified | ~25 |
| Duplicate type definitions identified | 2 sets |

---

### Recommendations for Future Cleanup

1. **HIGH PRIORITY:** Consolidate Policy types between `src/types/policy.ts` and `src/core/policy/schema.ts`
2. **MEDIUM PRIORITY:** Consolidate duplicate `SourceType` and `Decision` type definitions
3. **LOW PRIORITY:** Consider removing `maskPath()` function if not needed for future features
4. **LOW PRIORITY:** Review if all factory functions are needed in public API

---

### Testing Checklist

- [x] Build succeeds
- [x] All unit tests passing (404/404)
- [x] No console errors
- [x] Dependency removal verified

---

*Report generated by refactor-cleaner agent*
